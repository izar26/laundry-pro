import{u as X,r as u,a as J,b as m,j as e,H as Q,L as v}from"./app-BJUS283V.js";import{T as W,g as Z,P as ee,D as ae,a as se,b as te,c as re,d as w,A as ne}from"./AdminLayout-BVeV9NOV.js";import{D as ie}from"./data-table-CoXa6ch6.js";import{B as k}from"./button-Cknn52O-.js";import{B as L}from"./badge-kINtg_Iu.js";import{c as p}from"./utils-BELw0PCo.js";import{I as le}from"./input-DGvHYAy_.js";import{S as P,a as T,b as H,c as E,d as t}from"./select-BvWzF5g4.js";import{A as oe,a as ce,b as de,c as ue,d as me,e as he,f as xe,g as pe,E as ge}from"./alert-dialog-B6KqeVnj.js";import{C as fe,a as je,b as ye}from"./card-CQ5-kO-q.js";import{S as be}from"./spotlight-card-BrzQ6zST.js";import{t as c}from"./index-DvSpuR_m.js";import ve from"./KanbanBoard-CadTbVnU.js";import{C as we}from"./circle-check-DuPaCcZ3.js";import{C as ke}from"./clock-Dcwdhhio.js";import{c as h}from"./createLucideIcon-Bimzm9Cs.js";import{L as Ne}from"./loader-circle-H5mEidIU.js";import{T as A}from"./trash-BcYkvIBz.js";import{C as Ce}from"./calendar-D7txQE-s.js";import{B as Se}from"./banknote-DJwzxEsa.js";import{C as I}from"./credit-card-BucyS69_.js";import{P as _e}from"./printer-kqvYBcmd.js";import{f as De}from"./format-rTHyNvvs.js";import{i as Me}from"./id-QyG5z1i5.js";import"./dialog-D6sxQ6X3.js";import"./index-2G1qpvYq.js";import"./index-DGFwUscm.js";import"./index-GU3xWpFW.js";import"./index-DUpLxr6b.js";import"./check-BjYZDW6K.js";import"./avatar-XEMO5tCm.js";import"./index-PZITClZQ.js";import"./BackgroundParticles-Dk0cbptV.js";import"./shirt-ZtxoH7MD.js";import"./proxy-JpFdu96N.js";import"./index-DJhWr_N3.js";import"./index-D4zVgOqW.js";import"./react-redux-DSox-LOM.js";import"./tiny-invariant-BaFNuDhB.js";const Be=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ae=h("circle-alert",Be);const Ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Le=h("circle-x",Ie);const Pe=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Te=h("eye",Pe);const He=[["path",{d:"M5 3v14",key:"9nsxs2"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"M19 3v18",key:"1sk56x"}]],Ee=h("kanban",He);const Ve=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],Fe=h("layout-list",Ve);const ze=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ke=h("refresh-cw",ze),Re=({row:d,isReadOnly:g=!1})=>{const r=d.original,[n,l]=u.useState(!1),N=o=>{g||(l(!0),m.patch(route("transactions.status",r.id),{status:o},{onSuccess:()=>{c.success("Status diperbarui."),l(!1)},onError:()=>{c.error("Gagal."),l(!1)},preserveState:!0,preserveScroll:!0}))},i=o=>{switch(o){case"pending":return"bg-yellow-500 hover:bg-yellow-600 text-white";case"new":return"bg-slate-500 hover:bg-slate-600 text-white";case"process":return"bg-blue-500 hover:bg-blue-600 text-white";case"ready":return"bg-orange-500 hover:bg-orange-600 text-white";case"done":return"bg-emerald-600 hover:bg-emerald-700 text-white";case"cancelled":return"bg-red-500 hover:bg-red-600 text-white";default:return"bg-gray-500"}},x={pending:"Menunggu",new:"Baru Masuk",process:"Sedang Proses",ready:"Siap Ambil",done:"Selesai",cancelled:"Dibatalkan"};return g?e.jsx(L,{className:p("w-[110px] h-7 text-[10px] flex justify-center border-none",i(r.status)),children:x[r.status]||r.status}):e.jsxs(P,{defaultValue:r.status,onValueChange:N,disabled:n,children:[e.jsx(T,{className:`w-[110px] h-7 text-xs border-none font-medium ${i(r.status)}`,children:e.jsx(H,{})}),e.jsxs(E,{children:[e.jsx(t,{value:"pending",children:"Menunggu"}),e.jsx(t,{value:"new",children:"Baru Masuk"}),e.jsx(t,{value:"process",children:"Sedang Proses"}),e.jsx(t,{value:"ready",children:"Siap Ambil"}),e.jsx(t,{value:"done",children:"Selesai"}),e.jsx(t,{value:"cancelled",children:"Dibatalkan"})]})]})},$e=({transactions:d,kanbanData:g,stats:r,filters:n})=>{const{midtrans_client_key:l,auth:N}=X().props,i=N.user,x=i.roles?.includes("pelanggan"),o=i.roles?.includes("owner"),V=x||o,F=i.roles?.includes("admin")||i.roles?.includes("owner")||i.roles?.includes("pegawai"),z=!o,[M,B]=u.useState(null),[C,S]=u.useState(null),{delete:K,processing:f}=J({}),[j,R]=u.useState(n.search||"");u.useEffect(()=>{const a=setTimeout(()=>{j!==(n.search||"")&&m.get(route("transactions.index"),{...n,search:j,page:1},{preserveState:!0,replace:!0})},500);return()=>clearTimeout(a)},[j]);const y=n.view||"list",$=n.status||"all";u.useEffect(()=>{if(!l)return;const a="https://app.sandbox.midtrans.com/snap/snap.js",s=document.createElement("script");return s.src=a,s.setAttribute("data-client-key",l),s.async=!0,document.body.appendChild(s),()=>{document.body.contains(s)&&document.body.removeChild(s)}},[l]);const O=a=>{B(a),m.get(route("transactions.check-status",a),{},{preserveState:!0,onFinish:()=>B(null)})},q=a=>{window.snap?window.snap.pay(a,{onSuccess:function(s){c.success("Pembayaran Berhasil!"),m.reload()},onPending:function(s){c.info("Menunggu pembayaran...")},onError:function(s){c.error("Pembayaran gagal!")}}):c.error("Gagal memuat sistem pembayaran. Refresh halaman.")},G=()=>{C&&K(route("transactions.destroy",C),{onSuccess:()=>{S(null)},onError:()=>c.error("Gagal menghapus transaksi.")})},b=({title:a,value:s,icon:_,color:D,spotlight:Y})=>e.jsxs(be,{className:"h-full",spotlightColor:Y||"rgba(255, 255, 255, 0.2)",children:[e.jsxs(fe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(je,{className:"text-sm font-medium",children:a}),e.jsx(_,{className:`h-4 w-4 ${D}`})]}),e.jsx(ye,{children:e.jsx("div",{className:"text-2xl font-bold",children:s})})]}),U=[{accessorKey:"invoice_code",header:"Transaksi",cell:({row:a})=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-mono font-bold text-xs group-hover:text-primary transition-colors",children:a.getValue("invoice_code")}),e.jsxs("span",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),De(new Date(a.original.created_at),"dd MMM, HH:mm",{locale:Me})]})]})},{accessorKey:"customer.user.name",header:"Pelanggan",cell:({row:a})=>e.jsx("div",{className:"font-medium text-sm",children:a.original.customer.user?.name||"Umum"})},...F?[{accessorKey:"user.name",header:"Dibuat Oleh",cell:({row:a})=>{const s=a.original.user?.id,_=a.original.customer?.user_id,D=s===_;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"font-medium text-sm text-muted-foreground",children:D?"Pelanggan":a.original.user?.name})})}}]:[],{accessorKey:"final_amount",header:"Total",cell:({row:a})=>{const s=parseFloat(a.getValue("final_amount"));return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground capitalize",children:[a.original.payment_method==="cash"?e.jsx(Se,{className:"h-3 w-3"}):e.jsx(I,{className:"h-3 w-3"}),a.original.payment_method]})]})}},{accessorKey:"payment_status",header:"Pembayaran",cell:({row:a})=>{const s=a.getValue("payment_status");return e.jsx(L,{variant:s==="paid"?"outline":"destructive",className:p("capitalize text-[10px]",s==="paid"?"border-emerald-500 text-emerald-600 bg-emerald-50":""),children:s==="paid"?"Lunas":"Belum Lunas"})}},{accessorKey:"status",header:"Status Cucian",cell:({row:a})=>e.jsx(Re,{row:a,isReadOnly:V})},{id:"actions",cell:({row:a})=>{const s=a.original;return e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[s.payment_method==="midtrans"&&s.payment_status==="unpaid"&&s.snap_token&&e.jsx(k,{variant:"outline",size:"icon",className:"h-7 w-7 text-orange-600 border-orange-200 bg-orange-50 hover:bg-orange-100",onClick:()=>q(s.snap_token),title:"Bayar Sekarang",children:e.jsx(I,{className:"h-3 w-3"})}),s.payment_method==="midtrans"&&s.payment_status==="unpaid"&&e.jsx(k,{variant:"outline",size:"icon",className:"h-7 w-7 text-blue-600 border-blue-200",onClick:()=>O(s.id),disabled:M===s.id,title:"Cek Status",children:e.jsx(Ke,{className:p("h-3 w-3",M===s.id&&"animate-spin")})}),e.jsxs(ae,{children:[e.jsx(se,{asChild:!0,children:e.jsx(k,{variant:"ghost",className:"h-7 w-7 p-0 hover:bg-muted",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(te,{align:"end",children:[e.jsx(re,{children:"Aksi"}),e.jsxs(w,{onClick:()=>window.open(route("transactions.print",s.id),"_blank"),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Cetak Struk"]}),e.jsx(w,{asChild:!0,children:e.jsxs(v,{href:route("transactions.show",s.id),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"})," Detail"]})}),x&&s.status==="pending"&&e.jsxs(w,{onClick:()=>{confirm("Yakin ingin membatalkan pesanan ini?")&&m.patch(route("transactions.cancel",s.id))},className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"})," Batalkan Pesanan"]}),!x&&!o&&e.jsxs(w,{onClick:()=>S(s.id),className:"text-destructive",children:[e.jsx(A,{className:"mr-2 h-4 w-4"})," Hapus"]})]})]})]})}}];return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Riwayat Transaksi"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsx(b,{title:"Omset Hari Ini",value:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r.revenue_today),icon:W,color:"text-emerald-500",spotlight:"rgba(16, 185, 129, 0.2)"}),e.jsx(b,{title:"Transaksi Hari Ini",value:r.trx_today,icon:we,color:"text-blue-500",spotlight:"rgba(59, 130, 246, 0.2)"}),e.jsx(b,{title:"Perlu Diproses",value:r.process_count,icon:ke,color:"text-orange-500",spotlight:"rgba(249, 115, 22, 0.2)"}),e.jsx(b,{title:"Belum Lunas",value:r.unpaid_count,icon:Ae,color:"text-red-500",spotlight:"rgba(239, 68, 68, 0.2)"})]}),e.jsxs("div",{className:"flex flex-col xl:flex-row items-start xl:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 w-full xl:w-auto",children:[e.jsxs("div",{className:"flex bg-muted rounded-lg p-1 shrink-0",children:[e.jsxs(v,{href:route("transactions.index",{...n,view:"list"}),className:p("px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2",y==="list"?"bg-background shadow text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Fe,{className:"h-4 w-4"})," List"]}),e.jsxs(v,{href:route("transactions.index",{...n,view:"board"}),className:p("px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2",y==="board"?"bg-background shadow text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Ee,{className:"h-4 w-4"})," Board"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-[250px]",children:[e.jsx(Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(le,{placeholder:"Cari invoice/nama...",value:j,onChange:a=>R(a.target.value),className:"pl-9 h-9"})]}),y==="list"&&e.jsxs(P,{value:$,onValueChange:a=>m.get(route("transactions.index",{...n,status:a,page:1})),children:[e.jsx(T,{className:"w-[140px] h-9",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"Semua"}),e.jsx(t,{value:"unpaid",children:"Belum Lunas"}),e.jsx(t,{value:"pending",children:"Menunggu"}),e.jsx(t,{value:"new",children:"Baru Masuk"}),e.jsx(t,{value:"process",children:"Sedang Proses"}),e.jsx(t,{value:"ready",children:"Siap Ambil"}),e.jsx(t,{value:"done",children:"Selesai"}),e.jsx(t,{value:"cancelled",children:"Batal"})]})]})]})]}),z&&e.jsx(k,{asChild:!0,size:"lg",className:"shadow-lg shadow-primary/20 w-full sm:w-auto",children:e.jsxs(v,{href:route("transactions.create"),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Transaksi Baru (POS)"]})})]}),y==="list"?e.jsx("div",{className:"bg-card rounded-xl border shadow-sm overflow-hidden",children:e.jsx(ie,{columns:U,data:d.data,pagination:d})}):e.jsx("div",{className:"h-[600px]",children:e.jsx(ve,{transactions:g})}),e.jsx(oe,{open:!!C,onOpenChange:a=>!a&&S(null),children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Hapus Transaksi?"}),e.jsx(me,{children:"Data transaksi ini akan dihapus permanen. Laporan keuangan akan berubah."})]}),e.jsxs(he,{children:[e.jsx(xe,{disabled:f,children:"Batal"}),e.jsxs(pe,{onClick:a=>{a.preventDefault(),G()},disabled:f,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[f?e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(A,{className:"mr-2 h-4 w-4"}),f?"Menghapus...":"Ya, Hapus"]})]})]})})]})};$e.layout=d=>e.jsx(ne,{children:d});export{$e as default};

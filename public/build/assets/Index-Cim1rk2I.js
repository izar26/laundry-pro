import{u as E,r as x,a as A,j as e,H as F}from"./app-BJUS283V.js";import{P as T,D as M,a as S,b as L,c as H,d as k,A as I}from"./AdminLayout-BVeV9NOV.js";import{D as K}from"./data-table-CoXa6ch6.js";import{B as j}from"./button-Cknn52O-.js";import{D as O,a as B,b as U,c as z,d as V,e as $}from"./dialog-D6sxQ6X3.js";import{A as G,a as J,b as R,c as W,d as Y,e as _,f as q,g as Q,E as X}from"./alert-dialog-B6KqeVnj.js";import{I as D}from"./input-DGvHYAy_.js";import{L as g}from"./label-CfrMJ7yu.js";import{T as Z}from"./textarea-BC1I0niA.js";import{U as ee,t as f}from"./index-DvSpuR_m.js";import{A as ae,a as se,b as ne}from"./avatar-XEMO5tCm.js";import{L as w}from"./loader-circle-H5mEidIU.js";import{T as C}from"./trash-BcYkvIBz.js";import{P as re}from"./pencil-DYUwNYHG.js";import"./utils-BELw0PCo.js";import"./index-2G1qpvYq.js";import"./index-DGFwUscm.js";import"./index-GU3xWpFW.js";import"./index-DUpLxr6b.js";import"./createLucideIcon-Bimzm9Cs.js";import"./check-BjYZDW6K.js";import"./BackgroundParticles-Dk0cbptV.js";import"./shirt-ZtxoH7MD.js";import"./proxy-JpFdu96N.js";import"./index-DJhWr_N3.js";import"./index-PZITClZQ.js";function ie({customer:s,isOpen:p,setIsOpen:h}){const{data:i,setData:t,post:d,put:N,processing:c,errors:n,reset:l,clearErrors:v}=A({name:"",phone:"",email:"",address:""});x.useEffect(()=>{s?t({name:s.user.name,phone:s.phone,email:s.user.email||"",address:s.address||""}):l(),v()},[s,p]);const o=r=>{r.preventDefault();const u={onSuccess:()=>{h(!1),l(),f.success(s?"Data pelanggan berhasil diperbarui.":"Pelanggan baru berhasil ditambahkan.")},onError:()=>{f.error("Terjadi kesalahan. Periksa input Anda.")}};s?N(route("customers.update",s.id),u):d(route("customers.store"),u)};return e.jsx(O,{open:p,onOpenChange:h,children:e.jsxs(B,{className:"sm:max-w-[500px]",children:[e.jsxs(U,{children:[e.jsx(z,{children:s?"Edit Data Pelanggan":"Tambah Pelanggan Baru"}),e.jsx(V,{children:s?"Ubah informasi pelanggan di bawah ini.":"Masukkan informasi pelanggan baru untuk database."})]}),e.jsxs("form",{onSubmit:o,className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(g,{htmlFor:"name",children:["Nama Lengkap ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{id:"name",placeholder:"Contoh: Budi Santoso",value:i.name,onChange:r=>t("name",r.target.value),className:n.name?"border-destructive":"",autoFocus:!0}),n.name&&e.jsx("span",{className:"text-xs text-destructive",children:n.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(g,{htmlFor:"phone",children:["No. HP / WhatsApp ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{id:"phone",placeholder:"0812...",value:i.phone,onChange:r=>t("phone",r.target.value),className:n.phone?"border-destructive":""}),n.phone&&e.jsx("span",{className:"text-xs text-destructive",children:n.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"email",children:"Email (Opsional)"}),e.jsx(D,{id:"email",type:"email",placeholder:"budi@example.com",value:i.email,onChange:r=>t("email",r.target.value)}),n.email&&e.jsx("span",{className:"text-xs text-destructive",children:n.email})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"address",children:"Alamat Lengkap"}),e.jsx(Z,{id:"address",placeholder:"Jl. Mawar No. 12, Kel. Melati...",value:i.address,onChange:r=>t("address",r.target.value),className:"resize-none",rows:3})]}),e.jsxs($,{className:"mt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Batal"}),e.jsxs(j,{type:"submit",disabled:c,children:[c&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),s?"Simpan Perubahan":"Simpan Pelanggan"]})]})]})]})})}function te({customers:s}){const{auth:p}=E().props,i=!p.user.roles?.includes("owner"),[t,d]=x.useState(!1),[N,c]=x.useState(null),[n,l]=x.useState(null),{delete:v,processing:o}=A({}),r=()=>{c(null),d(!0)},u=a=>{c(a),d(!0)},y=a=>{l(a)},P=()=>{n&&v(route("customers.destroy",n),{onSuccess:()=>{l(null),f.success("Pelanggan berhasil dihapus dari database.")},onError:()=>{f.error("Gagal menghapus pelanggan.")}})},b=[{accessorKey:"user.name",header:"Nama Pelanggan",cell:({row:a})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ae,{className:"h-8 w-8",children:[e.jsx(se,{src:a.original.user.avatar?`/storage/${a.original.user.avatar}`:`https://ui-avatars.com/api/?name=${a.original.user.name}&background=random`}),e.jsx(ne,{children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"font-medium",children:a.original.user.name})]})},{accessorKey:"phone",header:"Kontak",cell:({row:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:a.getValue("phone")}),a.original.user.email&&e.jsx("span",{className:"text-xs text-muted-foreground",children:a.original.user.email})]})},{accessorKey:"address",header:"Alamat",cell:({row:a})=>{const m=a.getValue("address");return e.jsx("div",{className:"max-w-[250px] truncate text-muted-foreground",title:m||"",children:m||"-"})}}];return i&&b.push({id:"actions",cell:({row:a})=>{const m=a.original;return e.jsx("div",{className:"flex justify-end",children:e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(X,{className:"h-4 w-4"})]})}),e.jsxs(L,{align:"end",children:[e.jsx(H,{children:"Aksi"}),e.jsxs(k,{onClick:()=>u(m),children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Edit Data"]}),e.jsxs(k,{onClick:()=>y(m.id),className:"text-destructive focus:text-destructive",children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," Hapus"]})]})]})})}}),e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Manajemen Pelanggan"}),e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Data Pelanggan"}),e.jsx("p",{className:"text-muted-foreground",children:"Kelola data pelanggan dan riwayat informasi kontak mereka."})]}),i&&e.jsxs(j,{onClick:r,size:"lg",children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," Tambah Pelanggan"]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(K,{columns:b,data:s.data,pagination:s,searchKey:"name"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{isOpen:t,setIsOpen:d,customer:N}),e.jsx(G,{open:!!n,onOpenChange:a=>!a&&l(null),children:e.jsxs(J,{children:[e.jsxs(R,{children:[e.jsx(W,{children:"Apakah Anda yakin?"}),e.jsx(Y,{children:"Tindakan ini tidak dapat dibatalkan. Data pelanggan ini akan dihapus permanen dari server."})]}),e.jsxs(_,{children:[e.jsx(q,{disabled:o,children:"Batal"}),e.jsxs(Q,{onClick:a=>{a.preventDefault(),P()},disabled:o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[o?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(C,{className:"mr-2 h-4 w-4"}),o?"Menghapus...":"Ya, Hapus"]})]})]})})]})]})}te.layout=s=>e.jsx(I,{children:s});export{te as default};

import{a as H,r as v,u as E,j as e,H as F,L as d,b as S}from"./app-CUXBW5dx.js";import{T as K,P as V,D as z,a as R,b as $,c as G,d as C,A as O}from"./AdminLayout-Dj6WvTEP.js";import{D as q}from"./data-table-c7Fdhk67.js";import{B as y}from"./index-BvATWSjf.js";import{B as U}from"./badge-DSYp6RDo.js";import{c as m}from"./utils-BELw0PCo.js";import{S as Y,a as J,b as Q,c as W,d as j}from"./select-BqLD07ma.js";import{A as X,a as Z,b as ee,c as ae,d as se,e as te,f as re,g as ne,E as oe}from"./alert-dialog-D3mrlBtR.js";import{C as ie,a as le,b as ce}from"./card-Dczj2hiM.js";import{S as de}from"./spotlight-card-CY9ososU.js";import{t}from"./index-B0o19xSs.js";import me from"./KanbanBoard-35VaW_5u.js";import{C as ue}from"./circle-check-BqQQN2KW.js";import{C as he}from"./clock-BJg8lBcD.js";import{c as u}from"./createLucideIcon-uJREzNGo.js";import{L as xe}from"./loader-circle-CiGR35HH.js";import{T as _}from"./trash-Bxym_lDS.js";import{C as pe}from"./calendar-BUo7cYUx.js";import{B as ge}from"./banknote-qYlopA63.js";import{C as D}from"./credit-card-7WpBEtQD.js";import{P as fe}from"./printer-CPrMJ3Uv.js";import{f as be}from"./format-rTHyNvvs.js";import{i as ye}from"./id-QyG5z1i5.js";import"./dialog-C2_qrMnw.js";import"./index-88lnrqSU.js";import"./index-DFuNHLiv.js";import"./check-pd34nBtK.js";import"./BackgroundParticles-D888wk9C.js";import"./shirt-DHfAMZvd.js";import"./proxy-BiQenJV9.js";import"./index-Bgpi0fHY.js";import"./input-HL_z3B_7.js";import"./index-rFb6iV67.js";import"./react-redux-C078YcFW.js";import"./user-DF__yQ7w.js";const je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ve=u("circle-alert",je);const we=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ke=u("eye",we);const Ne=[["path",{d:"M5 3v14",key:"9nsxs2"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"M19 3v18",key:"1sk56x"}]],Ce=u("kanban",Ne);const Se=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],_e=u("layout-list",Se);const De=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Me=u("refresh-cw",De),Le=({row:r})=>{const l=r.original,[n,o]=v.useState(!1),c=i=>{o(!0),S.patch(route("transactions.status",l.id),{status:i},{onSuccess:()=>{t.success("Status diperbarui."),o(!1)},onError:()=>{t.error("Gagal."),o(!1)},preserveState:!0,preserveScroll:!0})},h=i=>{switch(i){case"new":return"bg-slate-500 hover:bg-slate-600 text-white";case"process":return"bg-blue-500 hover:bg-blue-600 text-white";case"ready":return"bg-orange-500 hover:bg-orange-600 text-white";case"done":return"bg-emerald-600 hover:bg-emerald-700 text-white";default:return"bg-gray-500"}};return e.jsxs(Y,{defaultValue:l.status,onValueChange:c,disabled:n,children:[e.jsx(J,{className:`w-[100px] h-7 text-xs border-none font-medium ${h(l.status)}`,children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(j,{value:"new",children:"Baru Masuk"}),e.jsx(j,{value:"process",children:"Sedang Proses"}),e.jsx(j,{value:"ready",children:"Siap Ambil"}),e.jsx(j,{value:"done",children:"Selesai"})]})]})},Ae=({transactions:r,kanbanData:l,stats:n,filters:o})=>{const{midtrans_client_key:c}=H().props,[h,i]=v.useState(null),[w,k]=v.useState(null),{delete:M,processing:x}=E({}),p=o.view||"list",g=o.status||"all";v.useEffect(()=>{if(!c)return;const s="https://app.sandbox.midtrans.com/snap/snap.js",a=document.createElement("script");return a.src=s,a.setAttribute("data-client-key",c),a.async=!0,document.body.appendChild(a),()=>{document.body.contains(a)&&document.body.removeChild(a)}},[c]);const L=s=>{i(s),S.get(route("transactions.check-status",s),{},{preserveState:!0,onFinish:()=>i(null)})},A=s=>{window.snap?window.snap.pay(s,{onSuccess:function(a){t.success("Pembayaran Berhasil!"),S.reload()},onPending:function(a){t.info("Menunggu pembayaran...")},onError:function(a){t.error("Pembayaran gagal!")}}):t.error("Gagal memuat sistem pembayaran. Refresh halaman.")},T=()=>{w&&M(route("transactions.destroy",w),{onSuccess:()=>{k(null)},onError:()=>t.error("Gagal menghapus transaksi.")})},f=({title:s,value:a,icon:N,color:I,spotlight:P})=>e.jsxs(de,{className:"h-full",spotlightColor:P||"rgba(255, 255, 255, 0.2)",children:[e.jsxs(ie,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(le,{className:"text-sm font-medium",children:s}),e.jsx(N,{className:`h-4 w-4 ${I}`})]}),e.jsx(ce,{children:e.jsx("div",{className:"text-2xl font-bold",children:a})})]}),b=({label:s,value:a,active:N})=>e.jsx(d,{href:route("transactions.index",{status:a,view:"list"}),className:m("px-4 py-2 text-sm font-medium rounded-full transition-colors",N?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:s}),B=[{accessorKey:"invoice_code",header:"Transaksi",cell:({row:s})=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-mono font-bold text-xs group-hover:text-primary transition-colors",children:s.getValue("invoice_code")}),e.jsxs("span",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),be(new Date(s.original.created_at),"dd MMM, HH:mm",{locale:ye})]})]})},{accessorKey:"customer.name",header:"Pelanggan",cell:({row:s})=>e.jsx("div",{className:"font-medium text-sm",children:s.original.customer.name})},{accessorKey:"final_amount",header:"Total",cell:({row:s})=>{const a=parseFloat(s.getValue("final_amount"));return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground capitalize",children:[s.original.payment_method==="cash"?e.jsx(ge,{className:"h-3 w-3"}):e.jsx(D,{className:"h-3 w-3"}),s.original.payment_method]})]})}},{accessorKey:"payment_status",header:"Pembayaran",cell:({row:s})=>{const a=s.getValue("payment_status");return e.jsx(U,{variant:a==="paid"?"outline":"destructive",className:m("capitalize text-[10px]",a==="paid"?"border-emerald-500 text-emerald-600 bg-emerald-50":""),children:a==="paid"?"Lunas":"Belum Lunas"})}},{accessorKey:"status",header:"Status Cucian",cell:({row:s})=>e.jsx(Le,{row:s})},{id:"actions",cell:({row:s})=>{const a=s.original;return e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[a.payment_method==="midtrans"&&a.payment_status==="unpaid"&&a.snap_token&&e.jsx(y,{variant:"outline",size:"icon",className:"h-7 w-7 text-orange-600 border-orange-200 bg-orange-50 hover:bg-orange-100",onClick:()=>A(a.snap_token),title:"Bayar Sekarang",children:e.jsx(D,{className:"h-3 w-3"})}),a.payment_method==="midtrans"&&a.payment_status==="unpaid"&&e.jsx(y,{variant:"outline",size:"icon",className:"h-7 w-7 text-blue-600 border-blue-200",onClick:()=>L(a.id),disabled:h===a.id,title:"Cek Status",children:e.jsx(Me,{className:m("h-3 w-3",h===a.id&&"animate-spin")})}),e.jsxs(z,{children:[e.jsx(R,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"h-7 w-7 p-0 hover:bg-muted",children:e.jsx(oe,{className:"h-4 w-4"})})}),e.jsxs($,{align:"end",children:[e.jsx(G,{children:"Aksi"}),e.jsxs(C,{onClick:()=>window.open(route("transactions.print",a.id),"_blank"),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"})," Cetak Struk"]}),e.jsx(C,{asChild:!0,children:e.jsxs(d,{href:route("transactions.show",a.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"})," Detail"]})}),e.jsxs(C,{onClick:()=>k(a.id),className:"text-destructive",children:[e.jsx(_,{className:"mr-2 h-4 w-4"})," Hapus"]})]})]})]})}}];return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Riwayat Transaksi"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsx(f,{title:"Omset Hari Ini",value:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n.revenue_today),icon:K,color:"text-emerald-500",spotlight:"rgba(16, 185, 129, 0.2)"}),e.jsx(f,{title:"Transaksi Hari Ini",value:n.trx_today,icon:ue,color:"text-blue-500",spotlight:"rgba(59, 130, 246, 0.2)"}),e.jsx(f,{title:"Perlu Diproses",value:n.process_count,icon:he,color:"text-orange-500",spotlight:"rgba(249, 115, 22, 0.2)"}),e.jsx(f,{title:"Belum Lunas",value:n.unpaid_count,icon:ve,color:"text-red-500",spotlight:"rgba(239, 68, 68, 0.2)"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex bg-muted rounded-lg p-1",children:[e.jsxs(d,{href:route("transactions.index",{view:"list"}),className:m("px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2",p==="list"?"bg-background shadow text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(_e,{className:"h-4 w-4"})," List"]}),e.jsxs(d,{href:route("transactions.index",{view:"board"}),className:m("px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2",p==="board"?"bg-background shadow text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Ce,{className:"h-4 w-4"})," Board"]})]}),p==="list"&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 w-full md:w-auto",children:[e.jsx(b,{label:"Semua",value:"all",active:g==="all"}),e.jsx(b,{label:"Belum Lunas",value:"unpaid",active:g==="unpaid"}),e.jsx(b,{label:"Sedang Proses",value:"process",active:g==="process"}),e.jsx(b,{label:"Selesai",value:"done",active:g==="done"})]}),e.jsx(y,{asChild:!0,size:"lg",className:"shadow-lg shadow-primary/20",children:e.jsxs(d,{href:route("transactions.create"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Transaksi Baru (POS)"]})})]}),p==="list"?e.jsx("div",{className:"bg-card rounded-xl border shadow-sm",children:e.jsx(q,{columns:B,data:r.data,pagination:r,searchKey:"invoice_code"})}):e.jsx("div",{className:"h-[600px]",children:e.jsx(me,{transactions:l})}),e.jsx(X,{open:!!w,onOpenChange:s=>!s&&k(null),children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(ae,{children:"Hapus Transaksi?"}),e.jsx(se,{children:"Data transaksi ini akan dihapus permanen. Laporan keuangan akan berubah."})]}),e.jsxs(te,{children:[e.jsx(re,{disabled:x,children:"Batal"}),e.jsxs(ne,{onClick:s=>{s.preventDefault(),T()},disabled:x,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[x?e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_,{className:"mr-2 h-4 w-4"}),x?"Menghapus...":"Ya, Hapus"]})]})]})})]})};Ae.layout=r=>e.jsx(O,{children:r});export{Ae as default};
